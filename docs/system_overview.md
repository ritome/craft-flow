# システム概要設計書

**プロジェクト名**: CraftFlow - レジデータ自動集計システム  
**バージョン**: 1.1.0  
**作成日**: 2025-11-15  
**最終更新**: 2025-11-21  
**対象**: Laravel 12 + MariaDB + Laravel Sail  

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [解決する課題](#2-解決する課題)
3. [機能要件](#3-機能要件)
4. [非機能要件](#4-非機能要件)
5. [技術スタック](#5-技術スタック)
6. [システムアーキテクチャ](#6-システムアーキテクチャ)
7. [データフロー](#7-データフロー)
8. [ディレクトリ構造](#8-ディレクトリ構造)
9. [主要コンポーネント](#9-主要コンポーネント)
10. [開発ルールと規約](#10-開発ルールと規約)
11. [期待効果](#11-期待効果)
12. [今後の拡張計画](#12-今後の拡張計画)

---

## 1. プロジェクト概要

### 1.1 目的

複数のPOSレジから出力されるPDFデータを自動で読み込み、売上データを抽出・集計し、Excel形式で出力する業務効率化システムを構築する。

### 1.2 背景

センターでは、日次の売上管理において以下の問題を抱えている：

- 4台のPOSレジから出力されるPDFデータを目視確認
- Excelデータへの手入力で転記
- 入力ミスが発生することがある
- 毎日10〜20分の作業時間がかかる

この手作業を自動化することで、業務効率を向上させ、正確性を担保する。

---

## 2. 解決する課題

### 2.1 現状の問題点

| 問題点 | 詳細 | 影響 |
|--------|------|------|
| **手作業による転記** | PDFから目視でデータを確認し、Excelに手入力 | 時間がかかる |
| **入力ミス** | 人的ミスによる転記エラー | データの正確性が低下 |
| **作業時間** | 毎日10〜20分の定型作業 | 生産性の低下 |
| **複数ファイル処理** | 4台のレジデータを個別に処理 | 煩雑な作業フロー |

### 2.2 解決策

- **自動化**: PDFアップロード → データ抽出 → 集計 → Excel出力を自動化
- **正確性**: プログラムによる処理で転記ミスを排除
- **効率化**: 作業時間を数分に短縮
- **一括処理**: 複数PDFファイルを同時処理

---

## 3. 機能要件

### 3.1 基本機能（必須）

#### 3.1.1 PDFアップロード機能

- **複数ファイル対応**: 最大4ファイル（レジ台数分）を同時アップロード
- **ファイル検証**: PDFファイル形式のチェック、ファイルサイズ制限（10MB/ファイル）
- **エラーハンドリング**: 不正なファイルは処理をスキップし、ログに記録

#### 3.1.2 PDFデータ抽出・パース機能

- **テキスト抽出**: `spatie/pdf-to-text` を使用したPDFからテキスト抽出
- **レジフォーマット判定**: テキストパターンから適切なパーサーを自動選択
- **データ構造化**: 販売数、売上金額、商品名などを構造化データに変換

**抽出項目（確定）**:
- **レジ番号**: POS1〜POS4（4台すべて同一フォーマット）
- **営業日**: 令和年→西暦変換（例: 令和7年11月5日 → 2025-11-05）
- **出力日時**: 令和年→西暦変換（例: 令和7年11月6日 17時30分 → 2025-11-06 17:30:00）
- **商品コード**: P001〜P030（**常に30商品固定**）
- **商品名**: 日本語名称（例: 南部鉄器 急須(小)）
- **単価**: 円単位の整数（例: 8,500円）
- **数量**: 販売個数（0以上の整数）
- **小計**: 単価×数量（円単位）
- **合計金額**: 全商品の小計合計

**PDFフォーマット特性**:
- ✅ **4台すべて同一フォーマット**（レジ番号のみ異なる）
- ✅ **商品数は常に30品目**（固定、増減なし）
- ✅ **単一ページ構成**（複数ページになることはない）
- ✅ **数量0の商品も含む**（全30商品が必ず出力される）

> **注**: PDFフォーマットの詳細は [docs/pdf_format_specification.md](./pdf_format_specification.md) 参照

#### 3.1.3 集計処理機能

- **データ正規化**: 各レジからの異なるフォーマットを統一形式に変換
- **集計ロジック**: 
  - レジ別集計
  - 商品別集計
  - 日別合計
- **エラー処理**: 一部のファイルが失敗しても、成功したファイルのみで集計を継続

#### 3.1.4 Excel出力・ダウンロード機能

- **Excel生成**: `maatwebsite/excel` を使用したExcelファイル生成
- **レイアウト**: 見やすい表形式での出力
- **ダウンロード**: 即座にダウンロード可能な形式で提供

### 3.2 追加機能（できれば実装）

#### 3.2.1 集計履歴保存機能

- 集計日時、ファイル名、処理結果をデータベースに保存
- 履歴一覧画面での閲覧

#### 3.2.2 履歴画面からの再ダウンロード機能

- 過去の集計結果を再ダウンロード
- ファイル管理とストレージ戦略

#### 3.2.3 売上分析機能

- 日別・月別の売上グラフ表示
- Chart.js または Laravel Charts による可視化
- ダッシュボード画面

---

## 4. 非機能要件

### 4.1 パフォーマンス

- **処理時間**: 4ファイル（各5ページ程度）を5秒以内に処理
- **メモリ消費**: 512MB以内での処理
- **大量データ対応**: Job キューを使用した非同期処理の構造

### 4.2 セキュリティ

- **ファイルアップロード**: MIMEタイプ検証、ファイルサイズ制限
- **一時ファイル管理**: 処理後の自動削除
- **アクセス制御**: 認証済みユーザーのみがアクセス可能（将来拡張）
- **ログ**: すべての処理をログに記録

### 4.3 保守性

- **コード品質**: PSR-12準拠、厳密な型宣言
- **テストカバレッジ**: 70%以上
- **ドキュメント**: 各コンポーネントのドキュメント整備
- **エラーハンドリング**: 適切な例外処理とログ出力

---

## 5. 技術スタック

### 5.1 バックエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **PHP** | 8.4+ | プログラミング言語 |
| **Laravel** | 12.x | Webアプリケーションフレームワーク |
| **MariaDB** | 最新 | データベース |
| **Composer** | 最新 | PHPパッケージ管理 |

### 5.2 フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **Blade** | - | テンプレートエンジン |
| **Livewire** | 3.x | リアクティブコンポーネント（必要時） |
| **Volt** | 1.x | Livewire Functional API |
| **TailwindCSS** | 4.x | CSSフレームワーク |
| **Alpine.js** | 最新 | 軽量JavaScriptフレームワーク |
| **Vite** | 最新 | フロントエンドビルドツール |

### 5.3 主要パッケージ

| パッケージ | 用途 |
|-----------|------|
| **spatie/pdf-to-text** | PDFからテキスト抽出 |
| **maatwebsite/excel** | Excel出力 |
| **laravel/sail** | Docker開発環境 |
| **pestphp/pest** | テストフレームワーク |
| **laravel/pint** | コードフォーマッター |

### 5.4 システム要件

- **poppler-utils**: `pdftotext` コマンド提供（PDF処理用）
- **Docker**: Laravel Sail による開発環境

---

## 6. システムアーキテクチャ

### 6.1 アーキテクチャパターン

本プロジェクトは **レイヤードアーキテクチャ** を採用し、以下のレイヤーで構成される：

```
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│  (Controller / Blade / Livewire Volt)   │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         Application Layer               │
│         (Service / Action)              │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         Domain Layer                    │
│    (Model / DTO / Business Logic)       │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│       Infrastructure Layer              │
│  (Repository / External Services)       │
└─────────────────────────────────────────┘
```

### 6.2 レイヤー責務

#### Presentation Layer（プレゼンテーション層）
- **Controller**: HTTPリクエスト受付、レスポンス返却のみ
- **Blade/Volt**: ビュー表示、ユーザーインタラクション

#### Application Layer（アプリケーション層）
- **Service**: 業務ロジックの統括、複数のドメインロジックを組み合わせる
- **Action**: 単一の業務処理を担当

#### Domain Layer（ドメイン層）
- **Model**: Eloquent ORM、データモデル
- **DTO**: データ転送オブジェクト

#### Infrastructure Layer（インフラストラクチャ層）
- **Repository**: データベース操作の抽象化
- **External Services**: 外部サービスとの連携

---

## 7. データフロー

### 7.1 PDF処理フロー

```
[ユーザー] 
    │
    │ 1. PDFファイルアップロード（複数）
    ▼
[Controller]
    │
    │ 2. バリデーション
    ▼
[PdfImportService] ────────┐
    │                      │
    │ 3. 一時保存          │ 各PDFファイルに対して
    ▼                      │ ループ処理
[PdfReader]                │
    │                      │
    │ 4. テキスト抽出      │
    ▼                      │
[ParserFactory]            │
    │                      │
    │ 5. パーサー選択      │
    ▼                      │
[PosRegisterParser]        │
    │                      │
    │ 6. データ構造化      │
    ▼                      │
[Normalizer] ──────────────┘
    │
    │ 7. データ正規化
    ▼
[Aggregator]
    │
    │ 8. 集計処理
    ▼
[ExcelExporter]
    │
    │ 9. Excel生成（SalesExport）
    ▼
[SummarySheet]          ─┐
[ProductAggregationSheet] ├─ 10. 各シート生成
[RegisterDetailSheet]    ─┘    (レイアウト・スタイル適用)
    │
    │ 11. Excelファイル統合
    ▼
[ストレージ保存]
    │
    │ 12. ダウンロード
    ▼
[ユーザー]
```

### 7.2 処理ステップ詳細

| ステップ | コンポーネント | 処理内容 | 例外処理 |
|---------|--------------|---------|---------|
| 1 | Controller | ファイルアップロード受付 | バリデーションエラー |
| 2 | Controller | ファイル形式・サイズ検証 | 400 Bad Request |
| 3 | PdfImportService | 一時ストレージに保存 | ディスク容量エラー |
| 4 | PdfReader | PDFからテキスト抽出 | 破損PDF、パスワード保護 |
| 5 | ParserFactory | テキストパターンからパーサー判定 | 未対応フォーマット |
| 6 | PosRegisterParser | 正規表現でデータ抽出 | パースエラー |
| 7 | Normalizer | データを統一フォーマットに変換 | データ不整合 |
| 8 | Aggregator | レジ別・商品別に集計 | - |
| 9 | ExcelExporter | Excel形式に変換（3シート構成） | ライブラリエラー |
| 10 | Controller | HTTPレスポンスで返却 | - |

---

## 8. ディレクトリ構造

```
craft-flow/
├── app/
│   ├── Http/
│   │   └── Controllers/
│   │       └── PdfImportController.php      # PDFインポート用コントローラー
│   ├── Services/
│   │   ├── PdfImportService.php            # PDF処理統括サービス
│   │   ├── PdfReader.php                   # PDFテキスト抽出
│   │   ├── ParserFactory.php               # パーサー選択ファクトリー
│   │   ├── Normalizer.php                  # データ正規化
│   │   ├── Aggregator.php                  # 集計処理
│   │   ├── ExcelExporter.php               # Excel出力
│   │   └── Parsers/
│   │       ├── ParserInterface.php         # パーサーインターフェース
│   │       ├── PosRegisterParser.php       # POSレジ用パーサー（汎用）
│   │       ├── PosAParser.php              # POSレジAタイプ用パーサー
│   │       └── PosBParser.php              # POSレジBタイプ用パーサー
│   ├── Models/
│   │   ├── User.php                        # ユーザーモデル
│   │   └── ImportHistory.php               # 集計履歴モデル
│   └── Exports/
│       ├── SalesExport.php                 # Excelエクスポートクラス（メイン）
│       ├── SalesDataExport.php             # Excelエクスポートクラス（旧）
│       └── Sheets/
│           ├── SummarySheet.php            # 集計サマリーシート
│           ├── ProductAggregationSheet.php # 商品別集計シート
│           └── RegisterDetailSheet.php     # レジ別詳細シート
├── database/
│   ├── migrations/
│   │   └── xxxx_create_import_histories_table.php
│   └── seeders/
├── resources/
│   └── views/
│       ├── welcome.blade.php               # トップページ
│       ├── upload.blade.php                # アップロード画面
│       ├── history.blade.php               # 履歴画面（実装済み）
│       ├── livewire/                       # Livewire/Voltコンポーネント
│       └── components/                     # 再利用可能コンポーネント
├── routes/
│   └── web.php                             # Webルーティング
├── tests/
│   ├── Unit/
│   │   └── Services/                       # サービス層のユニットテスト
│   └── Feature/
│       └── PdfImportTest.php               # PDF処理の統合テスト
├── storage/
│   └── app/
│       ├── pdf_temp/                       # PDF一時保存
│       └── exports/                        # Excel出力先
└── docs/
    ├── system_overview.md                  # システム概要（本文書）
    └── PdfReader.md                        # PdfReaderドキュメント
```

---

## 9. 主要コンポーネント

### 9.1 PdfImportService

**責務**: PDF処理全体を統括する

**依存関係**:
- `PdfReader`: テキスト抽出
- `ParserFactory`: パーサー選択
- `Normalizer`: データ正規化
- `Aggregator`: 集計処理
- `ExcelExporter`: Excel出力

**主要メソッド**:
```php
public function import(array $pdfFiles): string
```

**処理フロー**:
1. 各PDFファイルをループ処理
2. エラーが発生したファイルはスキップし、ログに記録
3. 成功したファイルのみで集計を実行
4. Excelファイルパスを返却

### 9.2 PdfReader

**責務**: PDFファイルからテキストを抽出

**依存ライブラリ**: `spatie/pdf-to-text`

**主要メソッド**:
```php
public function extract(string $filePath): string
```

**例外**:
- `InvalidArgumentException`: ファイルが存在しない、読み取れない
- `RuntimeException`: PDFからテキストを抽出できない

**詳細**: [docs/PdfReader.md](./PdfReader.md) 参照

### 9.3 ParserFactory

**責務**: テキストパターンから適切なパーサーを選択

**主要メソッド**:
```php
public function getParser(string $text): ParserInterface
```

**対応パーサー**:
- `PosRegisterParser`: POSレジ用パーサー（汎用、デフォルト）
- `PosAParser`: POSレジAタイプ用パーサー
- `PosBParser`: POSレジBタイプ用パーサー

**パーサー選択ロジック**:
PDFから抽出したテキストパターンを解析し、適切なパーサーを自動選択します。
特定のフォーマットに一致しない場合は、汎用的な `PosRegisterParser` が使用されます。

### 9.4 PosRegisterParser

**責務**: POSレジPDFのテキストを構造化データに変換

**実装**: `ParserInterface` を実装

**主要メソッド**:
```php
public function parse(string $text): array
```

**抽出データ形式**:
```php
[
    'register_id' => 1,
    'date' => '2025-11-15',
    'items' => [
        [
            'name' => '商品名',
            'quantity' => 10,
            'price' => 1000,
            'total' => 10000,
        ],
        // ...
    ],
    'total' => 50000,
]
```

### 9.5 Normalizer

**責務**: 各パーサーの出力を統一フォーマットに変換

**主要メソッド**:
```php
public function normalize(array $parsedData): array
```

### 9.6 Aggregator

**責務**: 複数のレジデータを集計

**主要メソッド**:
```php
public function aggregate(array $normalizedDataList): array
```

**集計ロジック**:
- レジ別合計
- 商品別合計
- 全体合計

### 9.7 ExcelExporter

**責務**: 集計データをExcel形式で出力

**依存ライブラリ**: `maatwebsite/excel`

**主要メソッド**:
```php
public function export(array $aggregatedData): string
```

**出力形式**:
- シート1: 集計サマリー（SummarySheet）
- シート2: 商品別集計（ProductAggregationSheet）
- シート3: レジ別詳細（RegisterDetailSheet）

**実装詳細**:
`SalesExport` クラスが `WithMultipleSheets` インターフェースを実装し、以下の3つのシートクラスを統合：

#### 9.7.1 SummarySheet（集計サマリーシート）
- **責務**: レジ別の売上概要を表示
- **機能**: 
  - レジ番号の昇順ソート
  - 処理日時、販売商品数、販売数量合計、売上金額を表示
  - ヘッダー行スタイリング（背景色: 青系）
  - 合計行スタイリング（背景色: 黄系）
  - カラム幅の自動調整
  - オートフィルタ機能

#### 9.7.2 ProductAggregationSheet（商品別集計シート）
- **責務**: 商品ごとの販売実績を集計
- **機能**:
  - 商品コード、商品名、単価、販売数量、売上金額を表示
  - 商品名カラムの幅を広く設定（60単位）
  - ヘッダー行スタイリング
  - 合計行スタイリング
  - オートフィルタ機能

#### 9.7.3 RegisterDetailSheet（レジ別詳細シート）
- **責務**: 各レジの取引明細を表示
- **機能**:
  - レジごとの商品明細表示
  - レジ小計行の挿入
  - 総合計行の表示
  - 小計行と総合計行の異なるスタイリング
  - オートフィルタ機能

**使用インターフェース**（各シートクラス共通）:
- `FromArray`: 配列データからシート生成
- `WithHeadings`: ヘッダー行の定義
- `WithTitle`: シートタイトルの設定
- `WithStyles`: セルスタイルの適用
- `WithColumnWidths`: カラム幅の設定
- `WithEvents`: オートフィルタなどのイベント処理

### 9.8 ImportHistory Model

**責務**: 集計履歴の永続化

**テーブル**: `import_histories`

**カラム**:
- `id`: プライマリーキー
- `import_date`: 集計日時
- `file_count`: 処理ファイル数
- `success_count`: 成功ファイル数
- `failed_count`: 失敗ファイル数
- `excel_path`: 生成されたExcelファイルパス
- `created_at`, `updated_at`: タイムスタンプ

---

## 10. 開発ルールと規約

### 10.1 コーディング規約

#### PHP / Laravel
- **厳密な型宣言**: すべてのファイルで `declare(strict_types=1)` を使用
- **型ヒント**: すべてのメソッドにパラメータ型、戻り値型を明示
- **コードスタイル**: PSR-12準拠（Laravel Pint で自動整形）
- **インデント**: スペース4個
- **Magic Number禁止**: 定数化する
- **コメント**: PHPDoc を必須化、日本語で記述

#### フロントエンド
- **Blade**: 基本はBladeテンプレート
- **Livewire Volt**: インタラクティブUIが必要な場合のみ
- **Functional スタイル**: Voltはクラスベースではなく、Functionalスタイルで実装
- **TailwindCSS**: すべてのスタイリングはTailwindで
- **Alpine.js**: 軽量なJavaScript処理

### 10.2 アーキテクチャルール

| レイヤー | 責務 | 禁止事項 |
|---------|------|---------|
| **Controller** | 入力受付、レスポンス返却のみ | ビジネスロジック、DB操作 |
| **Service** | 業務ロジック | 直接的なDB操作 |
| **Repository** | DB 読み書き | ビジネスロジック |
| **DTO** | データ受け渡し | ロジック記述 |
| **Job** | 重い処理を非同期化 | 同期的な実装 |
| **Model** | Eloquent ORM | ビジネスロジック |

### 10.3 データベース操作

- **Eloquent ORM優先**: 可能な限りEloquentを使用
- **生SQL禁止**: 必要な場合のみ、理由をコメントで明記
- **N+1問題**: Eager Loadingで回避
- **マイグレーション**: すべてのテーブル変更はマイグレーションで管理

### 10.4 テスト戦略

#### テスト種類
- **Feature テスト**: エンドツーエンドの統合テスト（優先）
- **Unit テスト**: Service、Parser、Reader単位のテスト

#### テストカバレッジ目標
- **全体**: 70%以上
- **Service層**: 90%以上
- **Parser層**: 100%（重要なロジックのため）

#### テストフレームワーク
- **Pest**: すべてのテストはPestで記述
- **Faker**: テストデータ生成

#### テスト実行
```bash
# すべてのテスト
./vendor/bin/sail artisan test

# 特定のテストのみ
./vendor/bin/sail artisan test --filter=PdfImportTest
```

### 10.5 エラーハンドリング

- **Service層で捕捉**: すべての例外はServiceレイヤーで捕捉
- **ログ出力**: エラー発生時は必ずログに記録（context情報付与）
- **ユーザーフィードバック**: わかりやすいエラーメッセージを表示
- **部分的な失敗**: 一部のファイルが失敗しても、成功したファイルで処理を継続

### 10.6 セキュリティ

- **環境変数**: `.env` ファイルで管理、`config/` 経由でアクセス
- **ファイルアップロード**: MIMEタイプ検証、サイズ制限
- **CSRF対策**: Laravelのミドルウェアで自動対応
- **XSS対策**: Bladeの自動エスケープ

---

## 11. 期待効果

### 11.1 定量的効果

| 指標 | 現状 | 目標 | 改善率 |
|------|------|------|-------|
| **作業時間** | 10〜20分/日 | 2〜3分/日 | **80〜85%削減** |
| **転記ミス** | 月1〜2回発生 | 0回 | **100%削減** |
| **処理速度** | 手作業 | 5秒以内 | - |

### 11.2 定性的効果

- **正確性向上**: プログラムによる処理で人的ミスを排除
- **業務効率化**: 単純作業から解放され、本来の業務に集中
- **データ活用**: 履歴保存により、データ分析が可能に
- **ストレス軽減**: 毎日の定型作業から解放

---

## 12. 今後の拡張計画

### 12.1 フェーズ1（現在）: 基本機能実装

- [x] PDFアップロード機能
- [x] PDFパース機能（複数パーサー対応）
- [x] 集計処理
- [x] Excel出力（3シート構成、スタイリング、フィルタ機能）
- [x] 集計履歴画面（UI実装済み）
- [ ] 集計履歴保存（バックエンド処理）

### 12.2 フェーズ2: 履歴管理機能

- [ ] 集計履歴一覧画面
- [ ] 過去データの再ダウンロード
- [ ] ファイル管理機能

### 12.3 フェーズ3: データ分析機能

- [ ] 日別売上グラフ
- [ ] 月別売上グラフ
- [ ] 商品別売上分析
- [ ] ダッシュボード画面

### 12.4 フェーズ4: 高度な機能

- [ ] 複数店舗対応
- [ ] ユーザー認証・認可
- [ ] API提供
- [ ] 自動スケジュール実行（日次バッチ）
- [ ] 通知機能（Slack連携など）

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| **POSレジ** | Point of Sale（販売時点情報管理）レジシステム |
| **パーサー** | テキストデータを構造化データに変換するプログラム |
| **正規化** | 異なるフォーマットのデータを統一形式に変換すること |
| **集計** | 複数のデータを合算・分類する処理 |
| **DTO** | Data Transfer Object（データ転送オブジェクト） |

### B. 関連ドキュメント

- **[README.md](./README.md)** - ドキュメント一覧（このフォルダのインデックス）
- **[PdfReader.md](./PdfReader.md)** - PdfReaderサービスの詳細仕様
- **[pdf_format_specification.md](./pdf_format_specification.md)** - POSレジPDFフォーマット仕様書
- **[parser_implementation_guide.md](./parser_implementation_guide.md)** - パーサー実装ガイド
- **[excel_output_specification.md](./excel_output_specification.md)** - Excel出力仕様書（3シート構成の詳細）

### C. Excelレイアウト仕様（実装済み機能）

#### シート1: 集計サマリー（SummarySheet）
- **レイアウト**: レジ番号 | 処理日時 | 販売商品数 | 販売数量合計 | 売上金額
- **ソート**: レジ番号の昇順
- **カラム幅**: A=15, B=45, C=20, D=25, E=20
- **スタイル**: ヘッダー（青系背景）、合計行（黄系背景）
- **機能**: オートフィルタ有効

#### シート2: 商品別集計（ProductAggregationSheet）
- **レイアウト**: 商品コード | 商品名 | 単価 | 販売数量 | 売上金額
- **カラム幅**: A=15, B=60（商品名を広く設定）, C=12, D=12, E=15
- **スタイル**: ヘッダー（青系背景）、合計行（黄系背景）
- **機能**: オートフィルタ有効

#### シート3: レジ別詳細（RegisterDetailSheet）
- **レイアウト**: レジ番号 | 商品コード | 商品名 | 単価 | 数量 | 小計
- **カラム幅**: A=15, B=20, C=60（商品名を広く設定）, D=12, E=12, F=15
- **スタイル**: 
  - ヘッダー（青系背景）
  - レジ小計行（薄い黄系背景）
  - 総合計行（黄系背景）
- **機能**: オートフィルタ有効

### D. 開発環境セットアップ

```bash
# リポジトリをクローン
git clone <repository-url>
cd craft-flow

# 依存パッケージをインストール
composer install
npm install

# 環境変数をコピー
cp .env.example .env

# アプリケーションキーを生成
./vendor/bin/sail artisan key:generate

# Sailを起動
./vendor/bin/sail up -d

# マイグレーション実行
./vendor/bin/sail artisan migrate

# poppler-utils をインストール（PDF処理用）
./vendor/bin/sail root-shell -c "apt-get update && apt-get install -y poppler-utils"

# テスト実行
./vendor/bin/sail artisan test
```

### E. トラブルシューティング

#### PDF処理でエラーが発生する
- `pdftotext` がインストールされているか確認
- PDFファイルが破損していないか確認
- ファイルサイズ制限を超えていないか確認

#### メモリ不足エラー
- `.env` で `memory_limit` を調整
- 大きなファイルはJob キューで非同期処理

#### テストが失敗する
- データベースがマイグレーションされているか確認
- テストフィクスチャ（サンプルPDF）が配置されているか確認

---

**文書履歴**

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|---------|-------|
| 2025-11-15 | 1.0.0 | 初版作成 | - |
| 2025-11-21 | 1.1.0 | 実装済み項目を追記（Sheets、Parser、Excelレイアウト仕様） | - |

---

**END OF DOCUMENT**

